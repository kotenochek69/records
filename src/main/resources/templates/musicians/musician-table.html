<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="musician-table">

    <table style="width:58%" border="0" class="table table-striped table-responsive-md">
        <thead>
        <tr>
            <th>Name</th>
            <th class="records-header">Records</th>
            <th>Records actions</th>
            <th>Country</th>
            <th>Action</th>

        </tr>
        </thead>
        <tbody>
        <tr th:id="${musician.id}" th:each="musician:${musicianlist}">
            <td th:text="${musician.name}"></td>
            <td class="records-cell" th:text="${musician.getRecords()}"></td>
            <td>
                <button class="add-button" th:onclick="'toggleForm(\'' + ${musician.id} + '\');'">+</button>
                <div id="addForm" th:name="${musician.id}" class="form-container">
                    <form th:action="@{'/data/musicians/' + ${musician.id}}" method="put" onsubmit="submitForm(event)">
                        <select th:label="Record" name="record">
                            <option th:each="record : ${records}" th:value="${record.id}"
                                    th:text="${record.name}"></option>
                        </select>
                        <input type="submit" value="üìÄ"/>
                    </form>
                </div>
            </td>
            <td th:text="${musician.getCountry()}"></td>
            <td>
                <button class="btn btn-danger delete-button" th:attr="data-musician-id=${musician.id}">Delete</button>
            </td>
        </tr>
        </tbody>
    </table>
    <script>
        function toggleForm(musicianId) {
            var form = document.getElementsByName(musicianId)[0];
            if (form.style.display === "none") {
                form.style.display = "block";
            } else {
                form.style.display = "none";
            }
        }

        // function submitForm(event) {
        //     event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
        //     var form = event.target; // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑–≤–∞–ª–∞ —Å–æ–±—ã—Ç–∏–µ
        //     var formData = new FormData(form); // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
        //
        //     // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
        //     fetch(form.action, {
        //         method: form.method,
        //         body: formData
        //     }).then(function (response) {
        //         // –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –¥–µ–ª–∞–µ–º –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
        //         window.location.reload();
        //     });
        // }

        document.addEventListener('DOMContentLoaded', function () {
            const deleteButtons = document.querySelectorAll('.delete-button');
            deleteButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    const musicianId = this.getAttribute('data-musician-id');

                    fetch('/data/musicians/' + musicianId, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    }).then(function (response) {
                        window.location.reload();
                    });

                });
            });
        });
    </script>
</div>
</body>
</html>
